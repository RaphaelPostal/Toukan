{% extends 'client/client-base.html.twig' %}
{% trans_default_domain 'client' %}
{% block title %}Menu{% endblock %}

{% block body %}

<style>
    .custom-shadow { box-shadow: 0px 0px 3px 1px rgba(0, 0, 0, 0.25); }
    .max-height { height:150px; width:auto;}
</style>

<ul class="flex m-3 font-bold bg-light-gray">
    {% for section in card.sections %}
        <li class="m-1"><a href="#{{section.title}}">{{section.title}}</a></li>
    {% endfor %}
    <li class="m-1"><a href="#autres">Autres</a></li>
</ul>


    {% for section in card.sections %}
        <div id="{{section.title}}" class="mb-20">
            <h3 class="border-toukan w-min m-3 border-2 text-2xl border-solid rounded-2xl pl-2 pr-2">{{section.title}}</h3>
            <div class="flex justify-around flex-wrap">
                {% for product in section.products %}
                    <div class="relative flex justify-between flex-col rounded-2xl custom-shadow m-2 w-5/12">
                        <div onclick="showDetails({{ product.id }})">
                            <img class="text-center w-11/12 m-auto max-height" src="{{asset('assets/uploads/'~card.establishment.id~'/'~product.image)}}">
                            <div class="h-px w-9/12 bg-black m-auto"></div>
                            <h4 class="text-center my-1 w-11/12 m-auto">{{product.title}}</h4>
                            <p class="border-solid bg-white border-toukan rounded-2xl pl-2 pr-2 border-2 absolute top-2 left-2">{{product.price|number_format(2, '.', ',')}} €</p>
                            {% if product.type %}
                                <p class="text-center w-11/12 m-auto">{{product.type}}</p>
                            {% endif %}
                        </div>
                        <div id="add-product" class="bg-toukan cursor-pointer flex w-full text-center p-2 rounded-b-2xl text-white justify-center" aria-valuetext="{{ product.id }}">Ajouter au panier</div>
                    </div>
                    <div id="details-{{ product.id }}" class="fixed w-full h-full text-center top-0 z-10 overflow-hidden hidden bg-white p-4">
                        <div class="inline-flex items-center">
                            <i onclick="showDetails({{ product.id }})" class="fa-solid fa-2xl fa-arrow-left"></i>
                            <h2 class="border-solid w-auto text-xl border-toukan rounded-2xl ml-5 pl-2 pr-2 border-2">{{product.title}}</h2>
                        </div>
                        <img class="text-center w-11/12 m-auto mt-2 max-height" src="{{asset('assets/uploads/'~card.establishment.id~'/'~product.image)}}">
                        <p class="border-solid bg-white rounded-2xl pl-2 pr-2 border-2 absolute -mt-6 ml-4">{{product.price|number_format(2, '.', ',')}} €</p>
                        <div class="h-px my-1 w-9/12 bg-black m-auto"></div>
{#                        {% if product.description %}#}
{#                            <p class="text-center w-11/12 m-auto">{{product.description}}</p>#}
{#                        {% endif %}#}
                        {% if product.ingredients %}
                        <h3 class="ml-4 text-left text-2xl font-bold">
                            <i class="fa-solid fa-carrot"></i>
                            <span class="underline">{{ 'card.ingredients'|trans }}</span>
                        </h3>
                        <p class="ml-4 text-left">{{ product.ingredients }}</p>
                        {% endif %}
                        {% if product.allergens %}
                            <h3 class="ml-4 text-left text-2xl font-bold">
                                <i class="fa-solid fa-carrot"></i>
                                <span class="underline">{{ 'card.allergens'|trans }}</span>
                            </h3>
                            <p class="ml-4 text-left">{{ product.allergens }}</p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        <div>
    {% endfor %}
    
    <a href="" class="bg-cover z-20 w-full bottom-0 fixed flex justify-center flex-col">
        <i class="text-center z-20 text-white text-3xl fa-solid fa-cart-shopping"></i>
        <div id="client-basket" class="text-center text-2xl z-20 text-white">Panier ({{ nbrProducts }})</div>
        <svg class="absolute" viewBox="0 0 375 85" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M191 1.0407C91.8 0.240703 22.3333 11.3742 0 22.0408V128.041H375V22.0408C355 12.0408 290.2 1.8407 191 1.0407Z" fill="#2E2E2E" stroke="black"/>
        </svg>
    </a>

    <script>
        function showDetails(id) {
            console.log(id);
            document.getElementById('details-'+id).classList.toggle('hidden');
        }

        document.querySelectorAll('#add-product').forEach(function(e) {
            e.addEventListener('click', function() {
                makeRequest(e)
            });
        });

        function makeRequest(e) {
            let product = e.getAttribute("aria-valuetext");
            let blankUrl = `{{ path('client_order_add_product', {'establishment':establishment.id, 'table':table.id, 'order':order.id, 'product':'productId'}) }}`
            let url = blankUrl.replace('productId', product);

            fetch(url).then(function (response) {
                return response.json();
            }).then(function (data) {
                document.getElementById("client-basket").innerHTML = data.nbrProducts;
            });
        }
    </script>
{% endblock %}

